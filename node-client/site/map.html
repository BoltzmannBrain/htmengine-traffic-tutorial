<!DOCTYPE html>
<html>
  <head>
    <link href="{{baseurl}}/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{baseurl}}/css/map.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="{{baseurl}}/bower_components/lodash/lodash.min.js"></script>
    <script src="{{baseurl}}/bower_components/handlebars/handlebars.min.js"></script>
    <script src="{{baseurl}}/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="{{baseurl}}/bower_components/moment/min/moment.min.js"></script>
    <script src="{{baseurl}}/bower_components/moment-timezone/builds/moment-timezone-with-data.min.js"></script>

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=places&key={{ googleMapsApiKey }}">
    </script>

    <script src="{{baseurl}}/js/utils.js"></script>
    <script src="{{baseurl}}/js/map.js"></script>


    <title></title>
  </head>
  <body>

    <div id="title">
        <h1>All Routes</h1>
        <h4><a href="{{ baseurl }}">HOME</a></h4>
        <p>Each route has a marker at its first point. Click it to get more details.</p>
    </div>

    <input id="pac-input" class="controls" type="text" placeholder="Search Box">

    <div id="map-canvas"></div>

    <script type="text/javascript">

        $(function() {

            var markerTemplate
              , pageTitle
              , mapOptions
              , query
              , map
              ;

            moment.tz.setDefault('America/New_York');

            $.get('{{ baseurl }}/templates/markerLabel.hbt', function(response) {
                markerTemplate = response;
            });

            query = getUrlVars();

            if (query.borough) {
                query.borough = query.borough.replace('%20',' ')
                pageTitle = 'Map of ' + query.borough;
            } else if (query.id) {
                pageTitle = 'Map of route(s): ' + query.id;
            }

            $('#title h1').html(pageTitle);
            $('title').html(pageTitle);

            map = new TrafficMap('map-canvas', '{{baseurl}}', {
                center: { lat: 40.7903, lng: -73.9597}
              , zoom: 11
            });

            $.getJSON('{{ baseurl }}/data/pathDetails', query, function(data) {
                map.setRoutePaths(data.paths, markerTemplate);
                map.enableSearchBox('pac-input');
                map.enableRightClickSearch();
            });

        });

    </script>

  </body>
</html>
